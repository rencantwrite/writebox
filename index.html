<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writebox</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:opsz,wght@8..144,300..600&display=swap" rel="stylesheet">

    <style>
        /* --- THEME VARIABLES --- */
        :root {
            /* Light (Standard) */
            --app-bg: #eef1f5;          
            --paper-bg: #ffffff;
            --text-main: #111111;       
            --border-color: #cccccc;    
            --accent-ui: #444444;
            --caret: #000000;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        body.dark-mode {
            --app-bg: #111111;
            --paper-bg: #1c1c1c;
            --text-main: #e6e6e6;
            --border-color: #333333;
            --accent-ui: #888888;
            --caret: #ffffff;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        body.green-mode {
            --app-bg: #142118;
            --paper-bg: #1e2e23;
            --text-main: #b8cfc0;
            --border-color: #2c4234;
            --accent-ui: #62856e;
            --caret: #b8cfc0;
            --shadow: rgba(0, 0, 0, 0.2);
        }

        body.red-mode {
            --app-bg: #211414;
            --paper-bg: #2e1e1e;
            --text-main: #cfb8b8;
            --border-color: #422c2c;
            --accent-ui: #856262;
            --caret: #cfb8b8;
            --shadow: rgba(0, 0, 0, 0.2);
        }

        body.yellow-mode {
            --app-bg: #e8e3d8;
            --paper-bg: #f7f3e8;
            --text-main: #4a4238;
            --border-color: #d1c8b4;
            --accent-ui: #8f8576;
            --caret: #4a4238;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        /* --- LAYOUT --- */
        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 50px 0 0 0; 
            background-color: var(--app-bg);
            font-family: 'Roboto Serif', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.2s ease;
            overflow-y: scroll; 
        }

        /* --- THE PAGE --- */
        .page-container {
            width: 148mm;
            min-height: 210mm;
            background-color: var(--paper-bg);
            border: 1px solid var(--border-color); 
            padding: 20mm 15mm;
            color: var(--text-main);
            
            /* Typography */
            font-size: 18px;            
            line-height: 1.6;            
            font-weight: 400;            
            
            outline: none;
            white-space: pre-wrap;
            caret-color: var(--caret);
            transition: all 0.2s ease;
            position: relative;
            
            padding-bottom: 80vh; 
            margin-bottom: 0;
        }

        /* Placeholder */
        .page-container:empty:before {
            content: "Start writing...";
            color: var(--accent-ui);
            opacity: 0.4;
            pointer-events: none;
        }

        /* --- THE BOTTOM DOCK (Toolbar) --- */
        .dock-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            
            display: flex;
            align-items: center;
            gap: 15px;
            
            background: var(--paper-bg);
            border: 1px solid var(--border-color);
            padding: 8px 20px;
            border-radius: 1px; 
            box-shadow: 0 4px 12px var(--shadow);
            z-index: 100;
            transition: all 0.2s ease;
        }

        /* Buttons */
        .dock-btn {
            background: transparent;
            border: none;
            font-family: 'Roboto Serif', serif;
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-ui);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }
        .dock-btn:hover {
            color: var(--text-main);
            background: var(--app-bg);
        }

        /* Vertical Divider */
        .divider {
            width: 1px;
            height: 18px;
            background-color: var(--border-color);
        }

        /* Word Count */
        .counter {
            font-size: 14px;
            color: var(--accent-ui);
            font-variant-numeric: tabular-nums;
            min-width: 60px;
            text-align: center;
            user-select: none;
        }

        /* Color Dots */
        .theme-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .color-dot {
            width: 14px;
            height: 14px;
            border-radius: 10%;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s;
            padding: 0;
        }
        .color-dot:hover { transform: scale(1.2); }
        
        .dot-light { background: #ffffff; }
        .dot-dark  { background: #1c1c1c; }
        .dot-sepia { background: #f7f3e8; }
        .dot-green { background: #1e2e23; }
        .dot-red   { background: #2e1e1e; }

        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--app-bg); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border: 3px solid var(--app-bg); border-radius: 10px; }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .page-container { width: 94%; padding: 15mm 10mm 70vh 10mm; } 
            .dock-container { width: 90%; justify-content: space-between; gap: 5px; padding: 8px 15px; }
        }
    </style>
</head>
<body class="light-mode">

    <div class="page-container" id="editor" contenteditable="true" spellcheck="false"></div>

    <div class="dock-container">
        
        <button class="dock-btn" onclick="downloadTxt()" id="saveBtn">Save</button>
        
        <div class="divider"></div>

        <button class="dock-btn" onclick="copyText()" id="copyBtn">Copy</button>

        <div class="divider"></div>

        <span class="counter"><span id="count">0</span> words</span>

        <div class="divider"></div>

        <div class="theme-group">
            <button class="color-dot dot-light" onclick="setTheme('light-mode')" title="Light"></button>
            <button class="color-dot dot-sepia" onclick="setTheme('yellow-mode')" title="Sepia"></button>
            <button class="color-dot dot-dark" onclick="setTheme('dark-mode')" title="Dark"></button>
            <button class="color-dot dot-green" onclick="setTheme('green-mode')" title="Green"></button>
            <button class="color-dot dot-red" onclick="setTheme('red-mode')" title="Red"></button>
        </div>

    </div>

    <script>
        const editor = document.getElementById('editor');
        const countSpan = document.getElementById('count');

        // Helper: Update Word Count
        function updateCount() {
            const text = editor.innerText.trim();
            const count = text.length === 0 ? 0 : text.split(/\s+/).length;
            countSpan.innerText = count;
        }

        // --- TYPEWRITER SCROLLING LOGIC ---
        function maintainCenterFocus() {
            const selection = window.getSelection();
            if (selection.rangeCount === 0) return;

            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            const threshold = window.innerHeight * 0.55;

            if (rect.top > threshold) {
                const offset = rect.top - (window.innerHeight / 2);
                window.scrollBy({
                    top: offset,
                    behavior: 'smooth' 
                });
            }
        }

        // 1. Live Word Counter + AUTO SAVE + Typewriter Scroll
        editor.addEventListener('input', function() {
            updateCount();
            localStorage.setItem('wb_content', editor.innerHTML);
            maintainCenterFocus(); 
        });

        editor.addEventListener('click', maintainCenterFocus);
        editor.addEventListener('keyup', (e) => {
            if(e.key === 'Enter') maintainCenterFocus();
        });

        // 2. Theme Switching
        function setTheme(themeName) {
            document.body.className = themeName;
            localStorage.setItem('wb_theme', themeName);
            editor.focus();
        }

        // 3. Copy Functionality
        function copyText() {
            const range = document.createRange();
            range.selectNodeContents(editor);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            
            document.execCommand('copy');
            sel.removeAllRanges();

            const btn = document.getElementById('copyBtn');
            const originalText = btn.innerText;
            btn.innerText = "COPIED!";
            setTimeout(() => { btn.innerText = originalText; }, 1500);
        }

        // 4. NEW: Download/Save Functionality
        function downloadTxt() {
            const text = editor.innerText;
            if (!text) return; // Do not save if empty

            // Create a blob object representing the text
            const blob = new Blob([text], { type: 'text/plain' });
            
            // Create a temporary anchor element to trigger download
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            
            // Generate filename with current date: "Note-2023-10-27.txt"
            const dateStr = new Date().toISOString().slice(0, 10);
            a.download = `Note-${dateStr}.txt`;
            
            document.body.appendChild(a);
            a.click(); // Trigger click
            document.body.removeChild(a); // Clean up
            URL.revokeObjectURL(a.href);

            // Visual feedback on button
            const btn = document.getElementById('saveBtn');
            const originalText = btn.innerText;
            btn.innerText = "SAVED!";
            setTimeout(() => { btn.innerText = originalText; }, 1500);
        }

        // 5. Initialize (Load Theme and Content)
        window.onload = function() {
            const savedTheme = localStorage.getItem('wb_theme');
            if(savedTheme) document.body.className = savedTheme;

            const savedContent = localStorage.getItem('wb_content');
            if(savedContent) {
                editor.innerHTML = savedContent;
                updateCount(); 
            }

            editor.focus();
            setTimeout(maintainCenterFocus, 100);
        }
    </script>
</body>
</html>
